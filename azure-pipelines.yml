trigger:
- main

pool:
  vmImage: 'windows-latest'

variables:
  azureSubscription: 'ServiceConnectionName1'
  resourceGroupName: 'Akhil_Test'
  location: 'East US'
  storageAccountName: 'teststorageaccount387'
  storageContainerName: 'templates'
  vnetName: 'VNet1'
  vnetAddressPrefix: '10.0.0.0/16'
  subnet1Name: 'Subnet1'
  subnet1Prefix: '10.0.0.0/24'
  subnet2Name: 'Subnet2'
  subnet2Prefix: '10.0.1.0/24'

jobs:
- job: DeployVNet
  displayName: 'Deploy VNet'
  steps:
  - checkout: self

  - task: UseDotNet@2
    inputs:
      packageType: 'sdk'
      version: '3.1.x'
      installationPath: $(Agent.ToolsDirectory)/dotnet

  - task: AzureCLI@2
    inputs:
      azureSubscription: $(azureSubscription)
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: |
        # Create a URL with the SAS token
        sasUrl=$(outputStorageUri)?sp=r&st=2024-02-09T20:45:48Z&se=2024-02-10T04:45:48Z&spr=https&sv=2022-11-02&sr=c&sig=VU0OUEyHWn9bFAVNhHBTncktXaByQDBRuvvY%2FRz%2BAVY%3D

        # Use AzCopy to copy files to Azure Storage
        azcopy copy "$(System.DefaultWorkingDirectory)" "$sasUrl" --recursive=true
    displayName: 'Copy files to Azure Storage'

  - task: AzureResourceGroupDeployment@3
    inputs:
      azureSubscription: $(azureSubscription)
      action: 'Create Or Update Resource Group'
      resource
